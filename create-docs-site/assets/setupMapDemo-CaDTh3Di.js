var z=Object.defineProperty;var q=(s,e,t)=>e in s?z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>q(s,typeof e!="symbol"?e+"":e,t);import{S as Y,h as V,i as K,j as W,k as J,r as X,F as D,P as R,l as f,V as v,m as h,n as g,C as Z,o as T,p as b,q as H,L as j,R as Q,T as ee,s as te,t as N}from"./iframe-B6O5ijz9.js";class E extends Y{constructor(e,t,o){super(),o!==void 0&&t===void 0?this.setFlatCoordinates(o,e):(t=t||0,this.setCenterAndRadius(e,t,o))}clone(){const e=new E(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,o,i){const a=this.flatCoordinates,r=e-a[0],d=t-a[1],c=r*r+d*d;if(c<i){if(c===0)for(let p=0;p<this.stride;++p)o[p]=a[p];else{const p=this.getRadius()/Math.sqrt(c);o[0]=a[0]+p*r,o[1]=a[1]+p*d;for(let n=2;n<this.stride;++n)o[n]=a[n]}return o.length=this.stride,c}return i}containsXY(e,t){const o=this.flatCoordinates,i=e-o[0],a=t-o[1];return i*i+a*a<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,o=t[this.stride]-t[0];return V(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(K(e,t)){const o=this.getCenter();return e[0]<=o[0]&&e[2]>=o[0]||e[1]<=o[1]&&e[3]>=o[1]?!0:W(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+o;for(let a=1;a<t;++a)i[t+a]=e[a];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,o){this.setLayout(o,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let a=J(i,0,e,this.stride);i[a++]=i[0]+t;for(let r=1,d=this.stride;r<d;++r)i[a++]=i[r];i.length=a,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const o=this.getCenter(),i=this.getStride();this.setCenter(X(o,0,o.length,i,e,t,o)),this.changed()}}const se=s=>new D({geometry:new R(f([s.longitude,s.latitude])),...s}),P=s=>s.map(se),oe=6,ie="#d4351c",ae="#505a5f",ne=2,re=!0,le={fill:ie,radius:oe,stroke:{color:ae,width:ne}};class de extends v{constructor({positions:e,style:t=le,title:o,visible:i=re,zIndex:a}){super({properties:{title:o},source:new g({features:P(e)}),style:new h({image:new Z({radius:t.radius,fill:new b({color:t.fill}),stroke:new T({color:t.stroke.color,width:t.stroke.width})})}),visible:i,zIndex:a})}}class ce{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"locations"}getNativeLayer(){return this.olLayer}attach(e,t){if(e.mapLibrary!=="openlayers"){console.warn(`[LocationLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:o}=e.openlayers;this.olLayer=new de({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:t?.visible??this.options.visible,zIndex:t?.zIndex??this.options.zIndex}),o.addLayer(this.olLayer)}detach(e){if(e.mapLibrary==="openlayers"){this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0);return}console.warn(`[LocationLayer] MapLibre detach is not implemented yet (layer "${this.id}")`)}}const pe=s=>new D({geometry:new E(f([s.longitude,s.latitude]),s.precision)}),ye=s=>s.map(pe),ue="rgba(255, 165, 0, 0.1)",me="orange",he=2,Le=!1,fe={fill:ue,stroke:{color:me,width:he}};class ve extends v{constructor({positions:e,style:t=fe,title:o,visible:i=Le,zIndex:a}){super({properties:{title:o},source:new g({features:ye(e)}),style:new h({fill:new b({color:t.fill}),stroke:new T({color:t.stroke.color,width:t.stroke.width})}),visible:i,zIndex:a})}}class ge{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"circles"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[CirclesLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new ve({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const G=(s,e,t)=>Math.max(e,Math.min(t,s)),x=10,C=1.25,Te=.15,O=2,be=s=>{const e=(O-C)/(Te-x),t=C-x*e;return G(e*s+t,C,O)};class _e extends h{constructor(e,t){super({stroke:new T({width:be(t),color:e})})}}const Se=(s,e)=>new D({geometry:new j([f([s.longitude,s.latitude]),f([e.longitude,e.latitude])])}),Ie=s=>new H(s.reduce((e,t,o)=>(o!==s.length-1&&e.push(Se(t,s[o+1])),e),[])),Ce=(s,e)=>{const t=e[0]-s[0],o=e[1]-s[1];return Math.atan2(o,t)},we=(s,e,t)=>{const o=e*Math.sin(t),i=e*Math.cos(t);return[s[0]+o,s[1]+i]},U=10,w=4,De=.15,k=6,Ee=s=>{const e=(k-w)/(De-U),t=w-U*e;return G(e*s+t,w,k)};class Ae extends h{constructor(e,t,o){super({geometry:new R(e),image:new Q({points:3,radius:Ee(t),fill:new b({color:"black"}),rotation:o,rotateWithView:!0})})}}const Fe=(s,e,t,o)=>{const a=50*o,r=Math.max(Math.floor(t/a),1),d=t/(r+1);return[...Array(r).keys()].map(c=>new Ae(we(s,d*(c+1),e),o,e))},Me=s=>(e,t)=>{const o=e.getGeometry(),i=o.getCoordinates(),a=o.getLength(),r=i[0],d=i[1],c=-Ce(r,d)+Math.PI/2;return[new _e(s.stroke.color,t),...Fe(r,c,a,t)]},Ne=!1,xe="black",Oe={stroke:{color:xe}};class Ue extends v{constructor({positions:e,style:t=Oe,title:o,visible:i=Ne,zIndex:a}){super({properties:{title:o},source:new g({features:Ie(e)}),style:Me(t),visible:i,zIndex:a})}}class ke{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"tracks"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[TracksLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new Ue({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const Re="sequenceNumber",Pe='bold 14px "GDS Transport", system-ui, sans-serif',Ge="black",$e="white",Be=2,ze=12,qe=1,Ye=!1,Ve={fill:Ge,font:Pe,offset:{x:ze,y:qe},stroke:{color:$e,width:Be}},Ke=(s,e)=>t=>t.get(e)!==void 0?[new h({text:new ee({textAlign:"left",textBaseline:"middle",font:s.font,fill:new b({color:s.fill}),stroke:new T({color:s.stroke.color,width:s.stroke.width}),text:String(t.get(e)),offsetX:s.offset.x,offsetY:s.offset.y})})]:[];class We extends v{constructor({numberProperty:e=Re,positions:t,style:o=Ve,title:i,visible:a=Ye,zIndex:r}){super({properties:{title:i},source:new g({features:P(t)}),style:Ke(o,e),visible:a,zIndex:r})}}class Je{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"numbering"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[NumberingLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new We({numberProperty:this.options.numberProperty,positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const Xe=[{latitude:53.4808,longitude:-2.2426,precision:50,sequenceNumber:1,speed:5,direction:1.57,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:00:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"5 km/h",displayDirection:"90°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:00:00",displayConfidence:"50m",displayLatitude:"53.4808",displayLongitude:"-2.2426"},{latitude:53.478,longitude:-2.25,precision:400,sequenceNumber:2,speed:15,direction:2.75,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:10:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"15 km/h",displayDirection:"158°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:10:00",displayConfidence:"400m",displayLatitude:"53.478",displayLongitude:"-2.25"},{latitude:53.483,longitude:-2.236,precision:200,sequenceNumber:3,speed:9,direction:.52,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:20:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"9 km/h",displayDirection:"30°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:20:00",displayConfidence:"200m",displayLatitude:"53.483",displayLongitude:"-2.236"},{latitude:53.476,longitude:-2.229,precision:500,sequenceNumber:4,speed:2,direction:3.14,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:30:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"2 km/h",displayDirection:"180°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:30:00",displayConfidence:"500m",displayLatitude:"53.476",displayLongitude:"-2.229"},{latitude:53.485,longitude:-2.26,precision:300,sequenceNumber:5,speed:4,direction:4.71,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:40:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"4 km/h",displayDirection:"270°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:40:00",displayConfidence:"300m",displayLatitude:"53.485",displayLongitude:"-2.26"},{latitude:53.472,longitude:-2.245,precision:100,sequenceNumber:6,speed:7,direction:5.23,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:50:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"7 km/h",displayDirection:"300°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:50:00",displayConfidence:"100m",displayLatitude:"53.472",displayLongitude:"-2.245"},{latitude:53.49,longitude:-2.255,precision:100,sequenceNumber:7,speed:3,direction:6.28,geolocationMechanism:"GPS",timestamp:"2025-01-01T13:00:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"3 km/h",displayDirection:"360°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 13:00:00",displayConfidence:"100m",displayLatitude:"53.49",displayLongitude:"-2.255"}],Ze={};function He(){const s="overlay-title-test-location",e="overlay-body-test-location";if(document.getElementById(s)&&document.getElementById(e))return;const t=document.createElement("template");t.id=s,t.innerHTML=`
    <div><strong>Name (NOMIS ID): {{personName}} ({{personNomisId}})</strong></div>
  `.trim();const o=document.createElement("template");o.id=e,o.innerHTML=`
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Speed </span><span class="app-map__overlay-value">{{displaySpeed}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Direction </span><span class="app-map__overlay-value">{{displayDirection}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Geolocation Mechanism </span><span class="app-map__overlay-value">{{displayGeolocationMechanism}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Recorded </span><span class="app-map__overlay-value">{{displayTimestamp}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Confidence </span><span class="app-map__overlay-value">{{displayConfidence}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Latitude </span><span class="app-map__overlay-value">{{displayLatitude}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Longitude </span><span class="app-map__overlay-value">{{displayLongitude}}</span></div>
  `.trim(),document.body.appendChild(t),document.body.appendChild(o)}function et({container:s=document.body,positions:e,renderer:t="openlayers",enable3D:o=!0,controls:i={grabCursor:!0,scale:"bar",locationDisplay:"latlon",rotate:"true",zoomSlider:!0},showPositions:a=!0,showTracks:r=!1,showNumbers:d=!1,showCircles:c=!1,usesInternalOverlays:p=!0}={}){const n=document.createElement("em-map"),A=Ze?.VITE_OS_MAPS_API_KEY??"",F=typeof window<"u"&&window.location.hostname.includes("github.io");let _,S;A&&!F?(_=`${N.tiles.urls.vectorStyleUrl}${N.tiles.urls.vectorStyleUrl.includes("?")?"&":"?"}key=${A}`,S="© Ordnance Survey"):(_="https://tile.openstreetmap.org/{z}/{x}/{y}.png",S="© OpenStreetMap contributors"),n.setAttribute("csp-nonce","1234abcd"),n.setAttribute("vector-test-url",_),n.setAttribute("data-demo-attribution",S),p&&(n.setAttribute("uses-internal-overlays",""),He()),t==="maplibre"&&n.setAttribute("renderer","maplibre"),o&&n.setAttribute("enable-3d-buildings",""),i.scale&&n.setAttribute("scale-control",i.scale),i.locationDisplay&&n.setAttribute("location-display",i.locationDisplay),i.rotate&&n.setAttribute("rotate-control",i.rotate),typeof i.zoomSlider=="boolean"&&n.setAttribute("zoom-slider",String(i.zoomSlider)),typeof i.grabCursor=="boolean"&&n.setAttribute("grab-cursor",String(i.grabCursor));const $=e??Xe,L=document.createElement("script");return L.type="application/json",L.slot="position-data",L.textContent=JSON.stringify($),n.appendChild(L),s.appendChild(n),n.addEventListener("map:ready",()=>{const y=n,I=y.olMapInstance,m=y.positions;if(!I||!m?.length)return;const B=y.addLayer(new ce({title:"pointsLayer",positions:m,visible:a}));y.addLayer(new ke({title:"tracksLayer",positions:m,visible:r})),y.addLayer(new Je({positions:m,numberProperty:"sequenceNumber",title:"numberingLayer",visible:d})),y.addLayer(new ge({positions:m,id:"confidence",title:"confidenceLayer",visible:c}));const M=B?.getSource?.();if(M){const u=M.getExtent();te(u)===!1&&I.getView().fit(u,{maxZoom:16,padding:[30,30,30,30],size:I.getSize()})}if(F){const u=document.createElement("small");u.textContent="Using OpenStreetMap tiles for public demo",u.style.cssText="position:absolute;bottom:4px;right:8px;font-size:0.75em;opacity:0.7;background:#fff;padding:2px 4px;border-radius:2px;",s.appendChild(u)}}),n}export{Xe as p,et as s};
