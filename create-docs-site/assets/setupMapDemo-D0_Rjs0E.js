var B=Object.defineProperty;var $=(s,e,t)=>e in s?B(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>$(s,typeof e!="symbol"?e+"":e,t);import{S as q,h as z,i as Y,j as X,k as W,r as K,F as I,P as k,l as L,V as f,m,n as v,C as V,o as T,p as g,q as J,L as Z,R as H,T as j,s as A,t as Q}from"./iframe-Do0EvzfF.js";class S extends q{constructor(e,t,o){super(),o!==void 0&&t===void 0?this.setFlatCoordinates(o,e):(t=t||0,this.setCenterAndRadius(e,t,o))}clone(){const e=new S(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,o,i){const a=this.flatCoordinates,n=e-a[0],l=t-a[1],c=n*n+l*l;if(c<i){if(c===0)for(let p=0;p<this.stride;++p)o[p]=a[p];else{const p=this.getRadius()/Math.sqrt(c);o[0]=a[0]+p*n,o[1]=a[1]+p*l;for(let r=2;r<this.stride;++r)o[r]=a[r]}return o.length=this.stride,c}return i}containsXY(e,t){const o=this.flatCoordinates,i=e-o[0],a=t-o[1];return i*i+a*a<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,o=t[this.stride]-t[0];return z(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Y(e,t)){const o=this.getCenter();return e[0]<=o[0]&&e[2]>=o[0]||e[1]<=o[1]&&e[3]>=o[1]?!0:X(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+o;for(let a=1;a<t;++a)i[t+a]=e[a];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,o){this.setLayout(o,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let a=W(i,0,e,this.stride);i[a++]=i[0]+t;for(let n=1,l=this.stride;n<l;++n)i[a++]=i[n];i.length=a,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const o=this.getCenter(),i=this.getStride();this.setCenter(K(o,0,o.length,i,e,t,o)),this.changed()}}const ee=s=>new I({geometry:new k(L([s.longitude,s.latitude])),...s}),O=s=>s.map(ee),te=6,se="#d4351c",oe="#505a5f",ie=2,ae=!0,ne={fill:se,radius:te,stroke:{color:oe,width:ie}};class re extends f{constructor({positions:e,style:t=ne,title:o,visible:i=ae,zIndex:a}){super({properties:{title:o},source:new v({features:O(e)}),style:new m({image:new V({radius:t.radius,fill:new g({color:t.fill}),stroke:new T({color:t.stroke.color,width:t.stroke.width})})}),visible:i,zIndex:a})}}class le{constructor(e){d(this,"id");d(this,"options");d(this,"olLayer");this.options=e,this.id=e.id??"locations"}getNativeLayer(){return this.olLayer}attach(e,t){if(e.mapLibrary!=="openlayers"){console.warn(`[LocationLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:o}=e.openlayers;this.olLayer=new re({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:t?.visible??this.options.visible,zIndex:t?.zIndex??this.options.zIndex}),o.addLayer(this.olLayer)}detach(e){if(e.mapLibrary==="openlayers"){this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0);return}console.warn(`[LocationLayer] MapLibre detach is not implemented yet (layer "${this.id}")`)}}const ce=s=>new I({geometry:new S(L([s.longitude,s.latitude]),s.precision)}),de=s=>s.map(ce),pe="rgba(255, 165, 0, 0.1)",ye="orange",ue=2,me=!1;class he extends f{constructor({positions:e,style:t,title:o,visible:i=me,zIndex:a}){let n;t?.fill===null?n=void 0:n=t?.fill??pe;let l;if(t?.stroke===null)l=void 0;else{const c=t?.stroke;l={color:c?.color??ye,width:c?.width??ue,lineDash:c?.lineDash}}super({properties:{title:o},source:new v({features:de(e)}),style:new m({fill:n?new g({color:n}):void 0,stroke:l?new T({color:l.color,width:l.width,lineDash:l.lineDash}):void 0}),visible:i,zIndex:a})}}class Le{constructor(e){d(this,"id");d(this,"options");d(this,"olLayer");this.options=e,this.id=e.id??"circles"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[CirclesLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new he({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const R=(s,e,t)=>Math.max(e,Math.min(t,s)),F=10,_=1.25,fe=.15,M=2,ve=s=>{const e=(M-_)/(fe-F),t=_-F*e;return R(e*s+t,_,M)};class Te extends m{constructor(e,t){super({stroke:new T({width:ve(t),color:e})})}}const ge=(s,e)=>new I({geometry:new Z([L([s.longitude,s.latitude]),L([e.longitude,e.latitude])])}),be=s=>new J(s.reduce((e,t,o)=>(o!==s.length-1&&e.push(ge(t,s[o+1])),e),[])),_e=(s,e)=>{const t=e[0]-s[0],o=e[1]-s[1];return Math.atan2(o,t)},Ce=(s,e,t)=>{const o=e*Math.sin(t),i=e*Math.cos(t);return[s[0]+o,s[1]+i]},N=10,C=4,Ie=.15,x=6,Se=s=>{const e=(x-C)/(Ie-N),t=C-N*e;return R(e*s+t,C,x)};class we extends m{constructor(e,t,o){super({geometry:new k(e),image:new H({points:3,radius:Se(t),fill:new g({color:"black"}),rotation:o,rotateWithView:!0})})}}const De=(s,e,t,o)=>{const a=50*o,n=Math.max(Math.floor(t/a),1),l=t/(n+1);return[...Array(n).keys()].map(c=>new we(Ce(s,l*(c+1),e),o,e))},Ee=s=>(e,t)=>{const o=e.getGeometry(),i=o.getCoordinates(),a=o.getLength(),n=i[0],l=i[1],c=-_e(n,l)+Math.PI/2;return[new Te(s.stroke.color,t),...De(n,c,a,t)]},Ae=!1,Fe="black",Me={stroke:{color:Fe}};class Ne extends f{constructor({positions:e,style:t=Me,title:o,visible:i=Ae,zIndex:a}){super({properties:{title:o},source:new v({features:be(e)}),style:Ee(t),visible:i,zIndex:a})}}class xe{constructor(e){d(this,"id");d(this,"options");d(this,"olLayer");this.options=e,this.id=e.id??"tracks"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[TracksLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new Ne({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const ke="sequenceNumber",Oe='bold 14px "GDS Transport", system-ui, sans-serif',Re="black",Ue="white",Pe=2,Ge=12,Be=1,$e=!1,qe={fill:Re,font:Oe,offset:{x:Ge,y:Be},stroke:{color:Ue,width:Pe}},ze=(s,e)=>t=>t.get(e)!==void 0?[new m({text:new j({textAlign:"left",textBaseline:"middle",font:s.font,fill:new g({color:s.fill}),stroke:new T({color:s.stroke.color,width:s.stroke.width}),text:String(t.get(e)),offsetX:s.offset.x,offsetY:s.offset.y})})]:[];class Ye extends f{constructor({textProperty:e=ke,positions:t,style:o=qe,title:i,visible:a=$e,zIndex:n}){super({properties:{title:i},source:new v({features:O(t)}),style:ze(o,e),visible:a,zIndex:n})}}class Xe{constructor(e){d(this,"id");d(this,"options");d(this,"olLayer");this.options=e,this.id=e.id??"text"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[TextLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new Ye({textProperty:this.options.textProperty,positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const We=[{latitude:53.4808,longitude:-2.2426,precision:50,sequenceNumber:1,speed:5,direction:1.57,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:00:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"5 km/h",displayDirection:"90°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:00:00",displayConfidence:"50m",displayLatitude:"53.4808",displayLongitude:"-2.2426"},{latitude:53.478,longitude:-2.25,precision:400,sequenceNumber:2,speed:15,direction:2.75,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:10:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"15 km/h",displayDirection:"158°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:10:00",displayConfidence:"400m",displayLatitude:"53.478",displayLongitude:"-2.25"},{latitude:53.483,longitude:-2.236,precision:200,sequenceNumber:3,speed:9,direction:.52,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:20:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"9 km/h",displayDirection:"30°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:20:00",displayConfidence:"200m",displayLatitude:"53.483",displayLongitude:"-2.236"},{latitude:53.476,longitude:-2.229,precision:500,sequenceNumber:4,speed:2,direction:3.14,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:30:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"2 km/h",displayDirection:"180°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:30:00",displayConfidence:"500m",displayLatitude:"53.476",displayLongitude:"-2.229"},{latitude:53.485,longitude:-2.26,precision:300,sequenceNumber:5,speed:4,direction:4.71,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:40:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"4 km/h",displayDirection:"270°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:40:00",displayConfidence:"300m",displayLatitude:"53.485",displayLongitude:"-2.26"},{latitude:53.472,longitude:-2.245,precision:100,sequenceNumber:6,speed:7,direction:5.23,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:50:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"7 km/h",displayDirection:"300°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:50:00",displayConfidence:"100m",displayLatitude:"53.472",displayLongitude:"-2.245"},{latitude:53.49,longitude:-2.255,precision:100,sequenceNumber:7,speed:3,direction:6.28,geolocationMechanism:"GPS",timestamp:"2025-01-01T13:00:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"3 km/h",displayDirection:"360°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 13:00:00",displayConfidence:"100m",displayLatitude:"53.49",displayLongitude:"-2.255"}];function Ke(){const s="overlay-title-test-location",e="overlay-body-test-location";if(document.getElementById(s)&&document.getElementById(e))return;const t=document.createElement("template");t.id=s,t.innerHTML=`
    <div><strong>Name (NOMIS ID): {{personName}} ({{personNomisId}})</strong></div>
  `.trim();const o=document.createElement("template");o.id=e,o.innerHTML=`
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Speed </span><span class="app-map__overlay-value">{{displaySpeed}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Direction </span><span class="app-map__overlay-value">{{displayDirection}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Geolocation Mechanism </span><span class="app-map__overlay-value">{{displayGeolocationMechanism}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Recorded </span><span class="app-map__overlay-value">{{displayTimestamp}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Confidence </span><span class="app-map__overlay-value">{{displayConfidence}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Latitude </span><span class="app-map__overlay-value">{{displayLatitude}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Longitude </span><span class="app-map__overlay-value">{{displayLongitude}}</span></div>
  `.trim(),document.body.appendChild(t),document.body.appendChild(o)}function Ze({container:s=document.body,positions:e,renderer:t="openlayers",enable3D:o=!0,controls:i={grabCursor:!0,scale:"bar",locationDisplay:"latlon",rotate:"true",zoomSlider:!0},showPositions:a=!0,showTracks:n=!1,showNumbers:l=!1,showCircles:c=!1,usesInternalOverlays:p=!0}={}){const r=document.createElement("em-map"),w="iXbItSbCB53tFNL2iP8kwQNmnfkWK0EX",U=`${A.tiles.urls.vectorStyleUrl}${A.tiles.urls.vectorStyleUrl.includes("?")?"&":"?"}key=${w}`;r.setAttribute("api-key",w),r.setAttribute("csp-nonce","1234abcd"),r.setAttribute("vector-test-url",U),p&&(r.setAttribute("uses-internal-overlays",""),Ke()),t==="maplibre"&&r.setAttribute("renderer","maplibre"),o&&r.setAttribute("enable-3d-buildings",""),i.scale&&r.setAttribute("scale-control",i.scale),i.locationDisplay&&r.setAttribute("location-display",i.locationDisplay),i.rotate&&r.setAttribute("rotate-control",i.rotate),typeof i.zoomSlider=="boolean"&&r.setAttribute("zoom-slider",String(i.zoomSlider)),typeof i.grabCursor=="boolean"&&r.setAttribute("grab-cursor",String(i.grabCursor));const P=e??We,h=document.createElement("script");return h.type="application/json",h.slot="position-data",h.textContent=JSON.stringify(P),r.appendChild(h),s.appendChild(r),r.addEventListener("map:ready",()=>{const y=r,b=y.olMapInstance,u=y.positions;if(!b||!u?.length)return;const G=y.addLayer(new le({title:"pointsLayer",positions:u,visible:a}));y.addLayer(new xe({title:"tracksLayer",positions:u,visible:n})),y.addLayer(new Xe({positions:u,textProperty:"sequenceNumber",title:"textLayer",visible:l})),y.addLayer(new Le({positions:u,id:"confidence",title:"confidenceLayer",visible:c}));const D=G?.getSource();if(D){const E=D.getExtent();Q(E)===!1&&b.getView().fit(E,{maxZoom:16,padding:[30,30,30,30],size:b.getSize()})}}),r}export{We as p,Ze as s};
