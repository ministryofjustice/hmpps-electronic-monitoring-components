var B=Object.defineProperty;var $=(s,e,t)=>e in s?B(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>$(s,typeof e!="symbol"?e+"":e,t);import{S as q,h as z,i as Y,j as W,k as X,r as K,F as S,P as O,l as L,V as f,m,n as v,C as V,o as T,p as g,q as J,L as Z,R as H,T as j,s as A,t as Q}from"./iframe-xJYtq_lK.js";class C extends q{constructor(e,t,o){super(),o!==void 0&&t===void 0?this.setFlatCoordinates(o,e):(t=t||0,this.setCenterAndRadius(e,t,o))}clone(){const e=new C(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,o,i){const a=this.flatCoordinates,r=e-a[0],c=t-a[1],d=r*r+c*c;if(d<i){if(d===0)for(let p=0;p<this.stride;++p)o[p]=a[p];else{const p=this.getRadius()/Math.sqrt(d);o[0]=a[0]+p*r,o[1]=a[1]+p*c;for(let n=2;n<this.stride;++n)o[n]=a[n]}return o.length=this.stride,d}return i}containsXY(e,t){const o=this.flatCoordinates,i=e-o[0],a=t-o[1];return i*i+a*a<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,o=t[this.stride]-t[0];return z(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Y(e,t)){const o=this.getCenter();return e[0]<=o[0]&&e[2]>=o[0]||e[1]<=o[1]&&e[3]>=o[1]?!0:W(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+o;for(let a=1;a<t;++a)i[t+a]=e[a];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,o){this.setLayout(o,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let a=X(i,0,e,this.stride);i[a++]=i[0]+t;for(let r=1,c=this.stride;r<c;++r)i[a++]=i[r];i.length=a,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const o=this.getCenter(),i=this.getStride();this.setCenter(K(o,0,o.length,i,e,t,o)),this.changed()}}const ee=s=>new S({geometry:new O(L([s.longitude,s.latitude])),...s}),R=s=>s.map(ee),te=6,se="#d4351c",oe="#505a5f",ie=2,ae=!0,ne={fill:se,radius:te,stroke:{color:oe,width:ie}};class re extends f{constructor({positions:e,style:t=ne,title:o,visible:i=ae,zIndex:a}){super({properties:{title:o},source:new v({features:R(e)}),style:new m({image:new V({radius:t.radius,fill:new g({color:t.fill}),stroke:new T({color:t.stroke.color,width:t.stroke.width})})}),visible:i,zIndex:a})}}class le{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"locations"}getNativeLayer(){return this.olLayer}attach(e,t){if(e.mapLibrary!=="openlayers"){console.warn(`[LocationLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:o}=e.openlayers;this.olLayer=new re({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:t?.visible??this.options.visible,zIndex:t?.zIndex??this.options.zIndex}),o.addLayer(this.olLayer)}detach(e){if(e.mapLibrary==="openlayers"){this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0);return}console.warn(`[LocationLayer] MapLibre detach is not implemented yet (layer "${this.id}")`)}}const ce=s=>new S({geometry:new C(L([s.longitude,s.latitude]),s.precision)}),de=s=>s.map(ce),pe="rgba(255, 165, 0, 0.1)",ye="orange",ue=2,me=!1,he={fill:pe,stroke:{color:ye,width:ue}};class Le extends f{constructor({positions:e,style:t=he,title:o,visible:i=me,zIndex:a}){super({properties:{title:o},source:new v({features:de(e)}),style:new m({fill:new g({color:t.fill}),stroke:new T({color:t.stroke.color,width:t.stroke.width})}),visible:i,zIndex:a})}}class fe{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"circles"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[CirclesLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new Le({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const U=(s,e,t)=>Math.max(e,Math.min(t,s)),F=10,_=1.25,ve=.15,M=2,Te=s=>{const e=(M-_)/(ve-F),t=_-F*e;return U(e*s+t,_,M)};class ge extends m{constructor(e,t){super({stroke:new T({width:Te(t),color:e})})}}const be=(s,e)=>new S({geometry:new Z([L([s.longitude,s.latitude]),L([e.longitude,e.latitude])])}),_e=s=>new J(s.reduce((e,t,o)=>(o!==s.length-1&&e.push(be(t,s[o+1])),e),[])),Ie=(s,e)=>{const t=e[0]-s[0],o=e[1]-s[1];return Math.atan2(o,t)},Se=(s,e,t)=>{const o=e*Math.sin(t),i=e*Math.cos(t);return[s[0]+o,s[1]+i]},N=10,I=4,Ce=.15,k=6,we=s=>{const e=(k-I)/(Ce-N),t=I-N*e;return U(e*s+t,I,k)};class De extends m{constructor(e,t,o){super({geometry:new O(e),image:new H({points:3,radius:we(t),fill:new g({color:"black"}),rotation:o,rotateWithView:!0})})}}const Ee=(s,e,t,o)=>{const a=50*o,r=Math.max(Math.floor(t/a),1),c=t/(r+1);return[...Array(r).keys()].map(d=>new De(Se(s,c*(d+1),e),o,e))},Ae=s=>(e,t)=>{const o=e.getGeometry(),i=o.getCoordinates(),a=o.getLength(),r=i[0],c=i[1],d=-Ie(r,c)+Math.PI/2;return[new ge(s.stroke.color,t),...Ee(r,d,a,t)]},Fe=!1,Me="black",Ne={stroke:{color:Me}};class ke extends f{constructor({positions:e,style:t=Ne,title:o,visible:i=Fe,zIndex:a}){super({properties:{title:o},source:new v({features:_e(e)}),style:Ae(t),visible:i,zIndex:a})}}class Oe{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"tracks"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[TracksLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new ke({positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const Re="sequenceNumber",Ue='bold 14px "GDS Transport", system-ui, sans-serif',xe="black",Pe="white",Ge=2,Be=12,$e=1,qe=!1,ze={fill:xe,font:Ue,offset:{x:Be,y:$e},stroke:{color:Pe,width:Ge}},Ye=(s,e)=>t=>t.get(e)!==void 0?[new m({text:new j({textAlign:"left",textBaseline:"middle",font:s.font,fill:new g({color:s.fill}),stroke:new T({color:s.stroke.color,width:s.stroke.width}),text:String(t.get(e)),offsetX:s.offset.x,offsetY:s.offset.y})})]:[];class We extends f{constructor({numberProperty:e=Re,positions:t,style:o=ze,title:i,visible:a=qe,zIndex:r}){super({properties:{title:i},source:new v({features:R(t)}),style:Ye(o,e),visible:a,zIndex:r})}}class Xe{constructor(e){l(this,"id");l(this,"options");l(this,"olLayer");this.options=e,this.id=e.id??"numbering"}getNativeLayer(){return this.olLayer}attach(e){if(e.mapLibrary!=="openlayers"){console.warn(`[NumberingLayer] MapLibre support is not implemented yet (layer "${this.id}")`);return}const{map:t}=e.openlayers;this.olLayer=new We({numberProperty:this.options.numberProperty,positions:this.options.positions,style:this.options.style,title:this.options.title??this.id,visible:this.options.visible,zIndex:this.options.zIndex}),t.addLayer(this.olLayer)}detach(e){e.mapLibrary==="openlayers"&&this.olLayer&&(e.openlayers.map.removeLayer(this.olLayer),this.olLayer=void 0)}}const Ke=[{latitude:53.4808,longitude:-2.2426,precision:50,sequenceNumber:1,speed:5,direction:1.57,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:00:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"5 km/h",displayDirection:"90°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:00:00",displayConfidence:"50m",displayLatitude:"53.4808",displayLongitude:"-2.2426"},{latitude:53.478,longitude:-2.25,precision:400,sequenceNumber:2,speed:15,direction:2.75,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:10:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"15 km/h",displayDirection:"158°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:10:00",displayConfidence:"400m",displayLatitude:"53.478",displayLongitude:"-2.25"},{latitude:53.483,longitude:-2.236,precision:200,sequenceNumber:3,speed:9,direction:.52,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:20:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"9 km/h",displayDirection:"30°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:20:00",displayConfidence:"200m",displayLatitude:"53.483",displayLongitude:"-2.236"},{latitude:53.476,longitude:-2.229,precision:500,sequenceNumber:4,speed:2,direction:3.14,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:30:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"2 km/h",displayDirection:"180°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:30:00",displayConfidence:"500m",displayLatitude:"53.476",displayLongitude:"-2.229"},{latitude:53.485,longitude:-2.26,precision:300,sequenceNumber:5,speed:4,direction:4.71,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:40:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"4 km/h",displayDirection:"270°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:40:00",displayConfidence:"300m",displayLatitude:"53.485",displayLongitude:"-2.26"},{latitude:53.472,longitude:-2.245,precision:100,sequenceNumber:6,speed:7,direction:5.23,geolocationMechanism:"GPS",timestamp:"2025-01-01T12:50:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"7 km/h",displayDirection:"300°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 12:50:00",displayConfidence:"100m",displayLatitude:"53.472",displayLongitude:"-2.245"},{latitude:53.49,longitude:-2.255,precision:100,sequenceNumber:7,speed:3,direction:6.28,geolocationMechanism:"GPS",timestamp:"2025-01-01T13:00:00Z",overlayTitleTemplateId:"overlay-title-test-location",overlayBodyTemplateId:"overlay-body-test-location",personName:"Jane Doe",personNomisId:"A1234BC",displaySpeed:"3 km/h",displayDirection:"360°",displayGeolocationMechanism:"GPS",displayTimestamp:"2025-01-01 13:00:00",displayConfidence:"100m",displayLatitude:"53.49",displayLongitude:"-2.255"}];function Ve(){const s="overlay-title-test-location",e="overlay-body-test-location";if(document.getElementById(s)&&document.getElementById(e))return;const t=document.createElement("template");t.id=s,t.innerHTML=`
    <div><strong>Name (NOMIS ID): {{personName}} ({{personNomisId}})</strong></div>
  `.trim();const o=document.createElement("template");o.id=e,o.innerHTML=`
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Speed </span><span class="app-map__overlay-value">{{displaySpeed}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Direction </span><span class="app-map__overlay-value">{{displayDirection}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Geolocation Mechanism </span><span class="app-map__overlay-value">{{displayGeolocationMechanism}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Recorded </span><span class="app-map__overlay-value">{{displayTimestamp}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Confidence </span><span class="app-map__overlay-value">{{displayConfidence}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Latitude </span><span class="app-map__overlay-value">{{displayLatitude}}</span></div>
    <div class="app-map__overlay-row"><span class="app-map__overlay-label">Longitude </span><span class="app-map__overlay-value">{{displayLongitude}}</span></div>
  `.trim(),document.body.appendChild(t),document.body.appendChild(o)}function He({container:s=document.body,positions:e,renderer:t="openlayers",enable3D:o=!0,controls:i={grabCursor:!0,scale:"bar",locationDisplay:"latlon",rotate:"true",zoomSlider:!0},showPositions:a=!0,showTracks:r=!1,showNumbers:c=!1,showCircles:d=!1,usesInternalOverlays:p=!0}={}){const n=document.createElement("em-map"),w="iXbItSbCB53tFNL2iP8kwQNmnfkWK0EX",x=`${A.tiles.urls.vectorStyleUrl}${A.tiles.urls.vectorStyleUrl.includes("?")?"&":"?"}key=${w}`;n.setAttribute("api-key",w),n.setAttribute("csp-nonce","1234abcd"),n.setAttribute("vector-test-url",x),p&&(n.setAttribute("uses-internal-overlays",""),Ve()),t==="maplibre"&&n.setAttribute("renderer","maplibre"),o&&n.setAttribute("enable-3d-buildings",""),i.scale&&n.setAttribute("scale-control",i.scale),i.locationDisplay&&n.setAttribute("location-display",i.locationDisplay),i.rotate&&n.setAttribute("rotate-control",i.rotate),typeof i.zoomSlider=="boolean"&&n.setAttribute("zoom-slider",String(i.zoomSlider)),typeof i.grabCursor=="boolean"&&n.setAttribute("grab-cursor",String(i.grabCursor));const P=e??Ke,h=document.createElement("script");return h.type="application/json",h.slot="position-data",h.textContent=JSON.stringify(P),n.appendChild(h),s.appendChild(n),n.addEventListener("map:ready",()=>{const y=n,b=y.olMapInstance,u=y.positions;if(!b||!u?.length)return;const G=y.addLayer(new le({title:"pointsLayer",positions:u,visible:a}));y.addLayer(new Oe({title:"tracksLayer",positions:u,visible:r})),y.addLayer(new Xe({positions:u,numberProperty:"sequenceNumber",title:"numberingLayer",visible:c})),y.addLayer(new fe({positions:u,id:"confidence",title:"confidenceLayer",visible:d}));const D=G?.getSource();if(D){const E=D.getExtent();Q(E)===!1&&b.getView().fit(E,{maxZoom:16,padding:[30,30,30,30],size:b.getSize()})}}),n}export{Ke as p,He as s};
